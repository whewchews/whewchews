---
import { Header } from "@components/misc";
import { BaseHead } from "@components/seo";
import { SITE_TITLE } from "@data/index";
import { SITE_DESCRIPTION, socialLinks } from "@data/index";
import RootLayout from "@layouts/root-layout.astro";
import { getPublishedCollection, getCategoryHoverColor, getUrl } from "@utils/index";

// Number of items to show per section
const PREVIEW_LIMIT = 5;

// Fetch tinker and archive posts
const tinkers = (await getPublishedCollection("tinker"))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, PREVIEW_LIMIT);

const archives = (await getPublishedCollection("archive"))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, PREVIEW_LIMIT);

const tinkerTotal = (await getPublishedCollection("tinker")).length;
const archiveTotal = (await getPublishedCollection("archive")).length;
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead
      title={SITE_TITLE}
      description={SITE_DESCRIPTION}
      image="/images/ogimage.png"
    />
  </head>

  <RootLayout>
    <div
      id="navbar+title"
      class="flex flex-col w-full gap-6 max-w-xl lowercase mb-20"
    >
      <Header />
      <h1
        class="w-full text-start text-[min(12vw,72px)] font-medium leading-[0.9] tracking-[-2px] sm:tracking-[-4px]"
      >
        whewchews
        <br />
        <!-- <span class="text-gray-500 dark:text-gray-400">— dev.log</span> -->
      </h1>
    </div>

    <div id="about" class="flex flex-col gap-4 w-full">
      <div class="font-medium text-lg text-gray-700 dark:text-gray-400">
        <!-- Based in South Korea. -->
      </div>
    </div>

    <div class="flex flex-col gap-10 w-full">
      <!-- Tinker Section -->
      <div id="tinker-section" class="flex flex-col gap-2 w-full">
        <a
          href={getUrl("/tinker")}
          class="text-2xl font-medium tracking-tight hover:underline underline-offset-2"
          >(tinker)</a
        >
        <div class="flex flex-col gap-2">
          {
            tinkers.length > 0 ? (
              tinkers.map((tinker) => {
                const category = tinker.data.category;
                const hoverClass = getCategoryHoverColor(category);

                return (
                  <a
                    href={getUrl(`/tinker/${tinker.slug}`)}
                    class={`group flex flex-row gap-3 items-baseline py-1 px-2 -mx-2 rounded transition-all ${hoverClass}`}
                  >
                    <span class="text-sm font-medium text-gray-600 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-gray-900">
                      {category}
                    </span>
                    <span class="text-lg font-medium text-gray-900 dark:text-gray-300 group-hover:text-gray-900 dark:group-hover:text-gray-900">
                      {tinker.data.title}
                    </span>
                  </a>
                );
              })
            ) : (
              <p class="text-gray-500 dark:text-gray-400 italic">
                No posts yet — still brewing ideas ☕️
              </p>
            )
          }
        </div>
        {
          tinkerTotal > PREVIEW_LIMIT && (
            <a
              href={getUrl("/tinker")}
              class="text-sm font-medium text-gray-700 dark:text-gray-400  dark:hover:text-gray-100 hover:underline underline-offset-2"
            >
              more ({tinkerTotal - PREVIEW_LIMIT} more) →
            </a>
          )
        }
      </div>

      <!-- Archive Section -->
      <div id="archive-section" class="flex flex-col gap-2 w-full">
        <a
          href={getUrl("/archive")}
          class="text-2xl font-medium tracking-tight hover:underline underline-offset-2"
          >(archive)</a
        >
        <div class="flex flex-col gap-2">
          {
            archives.length > 0 ? (
              archives.map((archive) => {
                const category = archive.data.category;
                const hoverClass = getCategoryHoverColor(category);

                return (
                  <a
                    href={getUrl(`/archive/${archive.slug}`)}
                    class={`group flex flex-row gap-3 items-baseline py-1 px-2 -mx-2 rounded transition-all ${hoverClass}`}
                  >
                    <span class="text-sm font-medium text-gray-600 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-gray-900">
                      {category}
                    </span>
                    <span class="text-lg font-medium text-gray-900 dark:text-gray-300 group-hover:text-gray-900 dark:group-hover:text-gray-900">
                      {archive.data.title}
                    </span>
                  </a>
                );
              })
            ) : (
              <p class="text-gray-500 dark:text-gray-400 italic">
                No posts yet — still brewing ideas ☕️
              </p>
            )
          }
        </div>
        {
          archiveTotal > PREVIEW_LIMIT && (
            <a
              href={getUrl("/archive")}
              class="text-sm font-medium text-gray-700 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 hover:underline underline-offset-2"
            >
              more ({archiveTotal - PREVIEW_LIMIT} more) →
            </a>
          )
        }
      </div>

      <div id="social-links" class="flex flex-col gap-2 w-full mt-10">
        <div class="flex flex-row gap-4 w-full">
          {
            socialLinks.map((link) => (
              <a
                href={link.url}
                class="text-lg font-medium text-gray-700 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 hover:underline underline-offset-2"
              >
                {link.label}
              </a>
            ))
          }
        </div>
      </div>
    </div>
  </RootLayout>
</html>
